{% extends "base.html" %}

{% block head %}
  {{ super() }}
  <title>STARP Primer Design</title>
  <style>
    #form-wrapper {
      width: 800px;
      left: 0;
      right: 0;
      margin: auto;
      background-color: #f8faf9;
      border-radius: 10px;
      padding: 10px;
      margin-top: 10px;
    }

    #snp_picker p {
      font-family: monospace;
    }

    #snp_picker button:hover {
      background-color: red !important;
      transition: background-color .75s;
    }
  </style>

  <script>
    $(document).ready(function() {
      $("#snp_picker").modal('show');
      $("#results").modal('show');
    });
  </script>
{% endblock %}

{% block body %}
  {{ super() }}
  <div class="container-fluid">
    <div id="form-wrapper">
      <form action="{{ url_for('starp_post') }}" method="post">
        <p>{{ form.input_data(class="form-control", placeholder="Place SNP Sequence Here", rows='8', cols='80') }}</p>

        {% if form.errors.items() %}
          <ul class="errors">
            {% for fieldName, errorMessages in form.errors.items() %}
              {% for error in errorMessages %}
                <li>{{ error }}</li>
              {% endfor %}
            {% endfor %}
          </ul>
        {% endif %}
        <p>{{ form.submit(class="btn btn-primary") }}</p>
      </form>

    </div>

    <!-- SNP Picker Display -->
    {% if snp_gui is defined %}
    <div class="modal fade" id="snp_picker" role="dialog">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">

          <div class="modal-header">
            <h2>Choose a SNP</h2>
          </div>

          <div class="modal-body">
            <form action="{{ url_for('starp_post') }}" method="post">
              <div>{{ snp_gui|safe }}</div>
              <!-- Necessary to persist form data between requests.
              This gives the appearance of AJAX updates while new
              templates are loaded. -->
              <div style="display: none">
                {{ form.input_data(rows='8', cols='80') }}
                {{ form.submit }}
              </div>
            </form>
          </div>

          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
          </div>

        </div>
      </div>
    </div>
    {% endif %}

    <!-- Display Results -->
    {% if starp is defined %}
    <div class="modal fade" id="results" role="dialog">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h2>Results</h2>
          </div>

          <div class="modal-body">
            <h4>Upstream AMAS Primers</h4>
            <hr>
            <table>
              <th>Name</th>
              <th>Sequence</th>

              {% for pair in starp.upstream_pairs %}
                <tr>
                  <td><b>AMAS 1</b></td>
                  <td>{{ pair[0][0].__repr__() }}</td>
                </tr>
                <tr>
                  <td><b>AMAS 2</b></td>
                  <td>{{ pair[0][1].__repr__() }}</td>
                </tr>
                <tr>
                  <td><b>Reverse Primer</b></td>
                  <td>{{ pair[1].__repr__() }}</td>
                </tr>
              {% endfor %}
            </table>

            <h4>Downstream AMAS Primers</h4>
            <hr>
            <table>
              <th>Name</th>
              <th>Sequence</th>
              {% for pair in starp.downstream_pairs %}
                <tr>
                  <td><b>AMAS 1</b></td>
                  <td>{{ pair[0][0].__repr__() }}</td>
                </tr>
                <tr>
                  <td><b>AMAS 2</b></td>
                  <td>{{ pair[0][1].__repr__() }}</td>
                </tr>
                <tr>
                  <td><b>Reverse Primer</b></td>
                  <td>{{ pair[1].__repr__() }}</td>
                </tr>
              {% endfor %}
            </table>
          </div>

          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
          </div>
        </div>
      </div>
    </div>
    {% endif %}
  </div>
{% endblock %}
